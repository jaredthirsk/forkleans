# OrleansCodeGen Final Solution

## The Core Problem

Orleans runtime expects OrleansCodeGen types (like `Codec_GrainId`) to exist in specific Orleans assemblies (e.g., Orleans.Core.Abstractions.dll). These types are:
1. Generated by Orleans source generators during build
2. Embedded directly in the Orleans assemblies
3. NOT generated in consuming assemblies

## What We Discovered

1. Microsoft's Orleans assemblies DO contain OrleansCodeGen types (verified in `Artifacts/DistributedTests/DistributedTests.Server/net8.0/Orleans.Core.Abstractions.dll`)
2. Granville Orleans assemblies DON'T contain these types because `Orleans_DesignTimeBuild=true` is set
3. Our shims can't forward types that don't exist in Granville assemblies

## The Real Solution

We need to ensure Granville Orleans assemblies contain the OrleansCodeGen types. This requires:

1. **Modify the Granville build process** to NOT set `Orleans_DesignTimeBuild=true` when building the Orleans assemblies themselves
2. **Ensure Orleans.CodeGenerator runs** during the Granville build to generate the types
3. **The shims can then forward** both regular types AND OrleansCodeGen types to Granville assemblies

## Implementation Steps

### Option A: Modify Props Files (Recommended)
1. Change the props files to only set `Orleans_DesignTimeBuild=true` for external consumers, not for Orleans itself
2. Add a condition like: `Condition="'$(IsOrleansCore)' != 'true'"`

### Option B: Force Code Generation
1. Add explicit references to Orleans.CodeGenerator in the Orleans projects
2. Set `Orleans_DesignTimeBuild=false` explicitly in each project file

### Option C: Use Microsoft DLLs as Base
1. Use Microsoft's Orleans DLLs (which have OrleansCodeGen types) as the base
2. Modify them to forward non-OrleansCodeGen types to Granville
3. This is complex and not recommended

## Why Current Approach Failed

- We tried to forward OrleansCodeGen types from shims, but they don't exist in Granville assemblies
- We can't just skip forwarding them because Orleans runtime specifically looks for them in Orleans.Core.Abstractions.dll
- The types MUST exist in the exact assembly that Orleans expects

## Next Steps

1. Modify the Granville Orleans build to generate OrleansCodeGen types
2. Rebuild all Granville Orleans assemblies
3. Keep the OrleansCodeGen type forwards in the shims
4. Test with the Shooter sample